<!DOCTYPE html>
<html lang="id">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   IMMt SHOP by Keuangan IMMt FTUI 2025
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <script src="https://unpkg.com/lucide-react@latest/dist/lucide-react.js">
  </script>
  <script src="https://unpkg.com/lucide@latest">
  </script>
  <!-- Firebase SDKs (hanya Firestore yang masih digunakan untuk data pesanan) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js">
  </script>
  <!-- EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script type="text/javascript">
     (function() {
        // Ganti 'YOUR_PUBLIC_KEY' dengan Public Key EmailJS Anda
        emailjs.init("7aaVlYJKN8iou8I14");
     })();
  </script>
  <style>
   body {
        font-family: "Inter", sans-serif;
        background-color: #f8fafc;
      }
      /* Style untuk modal */
      .modal-overlay {
        transition: opacity 0.3s ease-in-out;
        opacity: 0;
        pointer-events: none;
        position: fixed; /* Added for modal overlay */
        inset: 0; /* Added for modal overlay */
        background-color: rgba(0, 0, 0, 0.5); /* Added for modal overlay */
        display: flex; /* Added for modal overlay */
        align-items: center; /* Added for modal overlay */
        justify-content: center; /* Added for modal overlay */
        z-index: 50; /* Ensure modal is on top */
        overflow-y: auto; /* Allow scrolling within the modal if content overflows */
      }
      .modal-overlay.visible {
        opacity: 1;
        pointer-events: auto;
      }
      .modal-content {
        transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        transform: translateY(20px);
        opacity: 0;
        background-color: white; /* Added for modal content */
        border-radius: 0.75rem; /* Tailwind 'rounded-xl' */
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); /* Tailwind 'shadow-2xl' */
        width: 100%; /* Default width */
        max-width: 32rem; /* Tailwind 'max-w-lg' */
        max-height: 90vh; /* Limit height */
        overflow-y: auto; /* Added for scroll fix */
        position: relative; /* For close button positioning */
      }
      .modal-overlay.visible .modal-content {
        transform: translateY(0);
        opacity: 1;
      }
      /* Latar belakang hero section dengan gambar */
      .hero-section {
        position: relative;
        color: white;
        padding: 5rem 1rem;
        text-align: center;
        background-image: url("assets/bg-shop.jpg"); /* Reverted to original asset path */
        background-size: cover; /* Kembali ke ukuran cover */
        background-position: center; /* Kembali ke posisi tengah */
      }
      .hero-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(
          0,
          0,
          0,
          0.5
        ); /* Lapisan gelap untuk keterbacaan teks */
      }
      .hero-content {
        position: relative;
        z-index: 10;
      }
      /* Style untuk Animasi Centang */
      .success-animation-circle {
        stroke-dasharray: 264;
        stroke-dashoffset: 264;
        animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
      }
      .success-animation-checkmark {
        stroke-dasharray: 48;
        stroke-dashoffset: 48;
        animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
      }
      @keyframes stroke {
        100% {
          stroke-dashoffset: 0;
        }
      }
      .product-card {
        cursor: pointer;
      }
      .thumbnail-active {
        border-color: #4f46e5; /* Indigo */
        opacity: 1;
      }

      /* Custom styles for Shopee-like header */
      .shopee-header {
        background-color: #000000; /* Green accent */
        color: white;
        padding: 0.75rem 1rem; /* Adjust padding */
      }

      .shopee-header .logo-text {
        color: white; /* Ensure text is white for contrast */
      }

      .shopee-header .search-bar {
        flex-grow: 1;
        margin: 0 1rem;
      }

      .shopee-header .search-input {
        background-color: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding-left: 2.5rem; /* For icon */
        padding-right: 0.75rem;
        border-radius: 0.375rem; /* Tailwind 'rounded-lg' */
      }

      .shopee-header .search-icon {
        color: white;
      }

      .shopee-header .cart-button {
        background-color: transparent; /* No specific background for cart button */
      }

      .shopee-header .cart-button:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      /* Adjust promo card colors to fit green theme if desired */
      .bg-green-100 { background-color: #d1fae5; } /* light green for promo */
      .text-green-900 { color: #065f46; } /* dark green for promo text */
      .bg-yellow-100 { background-color: #d6d6d6; } /* light yellow for promo */
      .text-yellow-900 { color: #854d09; } /* dark yellow for promo text */


      /* Product Overview Modal Specific Styles */
      .product-overview-modal-content {
          background-color: #fff;
          border-radius: 1rem;
          padding: 1.5rem;
          max-height: unset; /* Menghilangkan batasan tinggi */
          position: relative;
          z-index: 60; /* Higher than other modals to ensure it's on top if active */
          /* Mengatur agar konten modal memiliki tata letak flexbox vertikal */
          display: flex;
          flex-direction: column;
      }
      .product-overview-modal-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: rgba(0, 0, 0, 0.7);
          display: flex;
          align-items: center;
          justify-content: center;
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.3s ease-in-out;
          z-index: 50;
      }
      .product-overview-modal-overlay.visible {
          opacity: 1;
          pointer-events: auto;
      }
      .product-overview-modal-close-btn {
          position: absolute;
          top: 1rem;
          right: 1rem;
          background: none;
          border: none;
          cursor: pointer;
          font-size: 1.5rem;
          color: #000;
          z-index: 70;
      }
      .product-overview-modal-content h2 {
          /* Judul akan tetap di atas saat konten di bawahnya digulir */
          position: sticky;
          top: 0;
          background-color: white; /* Memberikan latar belakang agar judul menutupi konten di bawahnya */
          z-index: 10; /* Memastikan judul berada di atas item yang digulir */
          padding-bottom: 1rem; /* Tambahkan padding di bawah judul */
          padding-top: 0.5rem; /* Tambahkan padding di atas judul */
          margin-top: -1.5rem; /* Sesuaikan dengan padding modal-content untuk menutupi penuh */
          margin-left: -1.5rem;
          margin-right: -1.5rem;
          width: calc(100% + 3rem); /* Sesuaikan lebar agar menutupi lebar penuh modal */
          box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Bayangan tipis untuk memisahkan judul */
      }
      .product-overview-grid {
          display: flex; /* Menggunakan flexbox untuk tata letak horizontal */
          gap: 1rem;
          overflow-x: auto; /* Memungkinkan gulir horizontal */
          -webkit-overflow-scrolling: touch; /* Mengaktifkan gulir yang mulus di iOS */
          padding-bottom: 1rem; /* Memberikan ruang untuk scrollbar jika muncul */
          flex-grow: 1; /* Memungkinkan grid mengisi ruang yang tersedia dan digulir */
          align-items: flex-start; /* Memastikan item promo rata atas jika tingginya berbeda */
      }
      .product-overview-item {
          background-color: #f0fdf4; /* A light green */
          border-radius: 0.75rem;
          padding: 1rem;
          text-align: center;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          cursor: pointer;
          transform: scale(1);
          transition: transform 0.2s ease-in-out;
          flex-shrink: 0; /* Mencegah item menyusut agar lebar aslinya tetap */
          width: 250px; /* Lebar tetap untuk setiap item promo */
          max-width: 90vw; /* Untuk memastikan tidak terlalu lebar di layar yang sangat kecil */
      }
      .product-overview-item:hover {
          transform: scale(1.02);
      }
      .product-overview-item img {
          border-radius: 0.5rem;
          margin-bottom: 0.75rem;
      }
      .product-overview-title {
          font-weight: 700; /* bold */
          color: #065f46; /* dark green */
          margin-bottom: 0.25rem;
      }
      .product-overview-description {
          color: #34d399; /* medium green */
          font-size: 0.875rem; /* sm */
      }
      .product-overview-price {
        font-weight: 600;
        color: #059669; /* green */
        margin-top: 0.5rem;
      }
      /* Styles for `bg-indigo-600` and `hover:bg-indigo-700` and `focus:ring-indigo-500` to be green */
      .bg-indigo-600 { background-color: #059669 !important; }
      .hover\:bg-indigo-700:hover { background-color: #047857 !important; }
      .focus\:ring-indigo-500:focus { box-shadow: 0 0 0 2px #047857 !important; }

      /* Adjusted width for main promo card on desktop */
      @media (min-width: 1024px) { /* lg breakpoint */
        #main-promo-card {
          max-width: 380px; /* Make it compact, similar to product overview modal */
          min-width: unset; /* Override previous min-width */
        }
      }

      /* New styles for Early Bundle page images (no longer a modal but general style) */
      .bundle-page-images .grid.grid-cols-2 img {
          width: 100%; /* Ensure images take full width of their grid column */
          height: 150px; /* Set a fixed height for consistency */
          object-fit: contain; /* Ensure the whole image is visible without cropping */
          background-color: #f8fafc; /* Add a background color to the image area */
      }

      /* Fix for product overview modal positioning and scroll on mobile */
      @media (max-width: 767px) { /* For mobile devices (up to md breakpoint) */
          .product-overview-modal-overlay {
              align-items: flex-start; /* Align to top */
              padding-top: 2rem; /* Add some padding from the top */
              overflow-x: hidden; /* Ensure overlay itself doesn't scroll horizontally */
          }
          .product-overview-modal-content {
              max-width: 95vw; /* Slightly wider on mobile */
              margin: 0 auto; /* Center the modal content */
              overflow-y: auto; /* Allow vertical scrolling for the entire content of the modal */
              overflow-x: hidden; /* Ensure modal content doesn't scroll horizontally */
              max-height: 90vh; /* Limit height to prevent modal from taking full screen */
          }
      }

      /* New: Fix for main promo cards on small screens */
      @media (max-width: 639px) { /* For screens smaller than sm (640px) */
          /* Ensure the container of main promo cards allows horizontal scrolling */
          .container.mx-auto.mt-8.mb-12.px-4 > div { /* Targeting the direct parent of flex space-x-4 */
              overflow-x: auto;
              -webkit-overflow-scrolling: touch;
              padding-bottom: 1rem; /* Space for scrollbar */
          }

          .flex.space-x-4.justify-center {
              justify-content: flex-start; /* Align items to the start instead of center */
              padding-left: 0; /* Remove fixed padding here, let it be handled by container */
              padding-right: 0;
              width: fit-content; /* Allow flex container to be as wide as its content */
          }
          /* Apply flex-shrink-0 to individual promo cards to prevent them from shrinking */
          #main-promo-card {
              flex-shrink: 0;
              width: 85vw; /* Make each card take up 85% of viewport width */
              max-width: 320px; /* Optional: max width for very large phones in portrait */
              margin-left: 0.5rem; /* Add some margin between cards instead of space-x-4 */
              margin-right: 0.5rem;
          }
          #main-promo-card:first-child {
              margin-left: 1rem; /* Ensure the first card has padding from the left edge */
          }
          #main-promo-card:last-child {
              margin-right: 1rem; /* Ensure the last card has padding from the right edge */
          }
      }

      /* Strikethrough price style */
      .strikethrough-price {
          text-decoration: line-through;
          color: #ef4444; /* Red color for strikethrough price */
          margin-right: 0.5rem;
          font-size: 0.9em; /* Slightly smaller than current price */
      }

      /* Styles for image zoom */
      .zoom-container {
          position: relative;
          overflow: hidden;
          cursor: zoom-in;
      }

      .zoom-container.zoomed {
          cursor: zoom-out;
      }

      .zoom-image {
          transition: transform 0.3s ease-out;
          transform-origin: 0 0; /* Important for consistent zoom behavior */
      }

      /* Custom alert modal */
      .custom-alert-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: rgba(0, 0, 0, 0.7);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 100;
      }
  </style>
 </head>
 <body class="antialiased text-gray-800">
  <div class="product-overview-modal-overlay" id="product-overview-modal">
   <div class="product-overview-modal-content">
    <button class="product-overview-modal-close-btn" id="close-product-overview-modal">
     <i data-lucide="x-circle">
     </i>
    </button>
    <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">
     Penawaran Spesial IMMt SHOP!
    </h2>
    <div class="product-overview-grid">
     <div class="product-overview-item" id="promo-simak-card" data-promo-id="simak-bundle">
      <img alt="Promo SIMAK EDITION!!" class="w-full h-40 object-cover" src="assets/promo-simak-1.jpg"/>
      <h3 class="product-overview-title">
       SIMAK EDITION!!
      </h3>
      <p class="product-overview-description">
       Dapatkan diskon khusus untuk SIMAK EDITION!!
      </p>
      <p class="product-overview-price">
      </p>
     </div>
    </div>
   </div>
  </div>


  <header class="shopee-header sticky top-0 z-40">
   <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 sm:h-20">
     <a class="flex items-center gap-2" href="#">
      <img alt="Logo IMMt Shop" class="h-10 w-10 sm:h-12 sm:w-12 rounded-full object-cover" onerror="this.onerror=null; this.src='assets/logo.jpg';" src="assets/logo.jpg"/>
      <span class="text-xl font-bold logo-text hidden sm:block">
       IMMt SHOP
      </span>
     </a>
     <div class="flex-1 search-bar">
      <div class="relative">
       <input class="w-full pl-10 pr-4 py-2 search-input text-sm sm:text-base" id="search-input" placeholder="Cari produk di IMMt SHOP..." type="text"/>
       <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <i class="w-5 h-5 search-icon" data-lucide="search">
        </i>
       </div>
      </div>
     </div>
     <nav class="hidden md:flex items-center gap-6 text-white font-medium">
        <a href="index.html" class="hover:text-gray-300 transition-colors">Beranda</a>
        <a href="#products-grid" class="hover:text-gray-300 transition-colors">Produk</a>
        <a href="#about-us" class="hover:text-gray-300 transition-colors">Tentang Kami</a>
     </nav>
     <div class="flex items-center gap-2 sm:gap-4">
      <button class="relative flex items-center p-2 rounded-full cart-button" id="open-cart-btn">
       <i class="w-6 h-6 text-white" data-lucide="shopping-cart">
       </i>
       <span class="absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full" id="cart-count-badge">
        0
       </span>
      </button>
      </div>
    </div>
   </div>
  </header>
  <main>
   <section class="hero-section">
    <div class="hero-content">
     <h2 class="text-4xl md:text-5xl font-extrabold tracking-tight">
      Selamat Datang!
     </h2>
     <p class="mt-4 max-w-2xl mx-auto text-lg md:text-xl text-gray-200">
      Situs resmi IMMt SHOP by Keuangan IMMt FTUI 2025
     </p>
    </div>
   </section>
   <!-- New Headline Section for Bundles -->
   <section class="container mx-auto mt-8 mb-4 px-4 text-center">
       <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900 leading-tight">
           Penawaran Spesial untuk Anda
       </h2>
   </section>
   <section class="container mx-auto mt-8 mb-12 px-4">
    <div class="overflow-x-auto whitespace-nowrap scrollbar-hide">
     <div class="flex space-x-4 justify-center">
      <div class="min-w-[300px] bg-green-100 text-center rounded-lg p-4 text-green-900 font-bold" id="main-promo-card" data-promo-id="simak-bundle">
       <img class="mb-2 rounded w-full h-40 object-cover aspect-video" src="assets/promo-simak-2.jpg" alt="Promo SIMAK EDITION!!"/>
       SIMAK EDITION!!
      </div>
     </div>
    </div>
   </section>
   <section class="container mx-auto text-center mt-16 mb-12 px-4">
    <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight">
     Koleksi Produk Pilihan Kami
    </h1>
    <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">
     Temukan produk berkualitas tinggi yang kami siapkan khusus untuk Anda.
    </p>
   </section>
   <section class="container mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8" id="products-grid">
    </section>
   <section class="bg-white mt-16 py-16" id="about-us">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
     <h2 class="text-3xl font-bold text-gray-900 mb-4">
      About Us
     </h2>
     <div class="max-w-xl mx-auto text-gray-700">
      <a href="https://www.instagram.com/immtshop?igsh=MTl4amQ5NXJrb2Vseg==" target="_blank" class="inline-flex items-center px-6 py-3 mt-4 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500">
        <i data-lucide="instagram" class="w-5 h-5 mr-2"></i>
        Check our instagram
      </a>
     </div>
    </div>
   </section>
  </main>
  <footer class="bg-gray-800 text-white">
   <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center">
    <p>
     © 2025 IMMt SHOP. All rights reserved
    </p>
   </div>
  </footer>
  <div class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" id="cart-modal">
   <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-lg">
    <div class="flex items-center justify-between p-5 border-b">
     <h2 class="text-2xl font-bold">
      Keranjang Belanja
     </h2>
     <button class="close-modal-btn p-1 rounded-full hover:bg-gray-200" data-modal-id="cart-modal">
      <i class="w-6 h-6" data-lucide="x">
      </i>
     </button>
    </div>
    <div class="p-5 max-h-[60vh] overflow-y-auto" id="cart-items">
    </div>
    <div class="p-5 bg-gray-50 border-t">
     <div class="flex justify-between items-center mb-4">
      <span class="text-lg font-semibold text-gray-600">
       Total:
      </span>
      <span id="cart-total" class="text-2xl font-bold text-gray-900">
       Rp 0
      </span>
     </div>
     <button class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700 disabled:bg-gray-400" id="checkout-btn">
      Lanjutkan ke Checkout
     </button>
     <button class="w-full bg-gray-400 text-white font-bold py-3 rounded-lg hover:bg-gray-500 mt-2" id="continue-shopping-btn">
      Lanjutkan Belanja
     </button>
    </div>
   </div>
  </div>
  <div class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" id="success-modal">
   <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-sm text-center p-8">
    <div class="mx-auto">
     <svg class="w-24 h-24 mx-auto" viewbox="0 0 100 100">
      <circle class="success-animation-circle" cx="50" cy="50" fill="transparent" r="40" stroke="#10B981" stroke-width="8">
      </circle>
      <polyline class="success-animation-checkmark" fill="transparent" points="30,55 45,70 70,40" stroke="#10B981" stroke-linecap="round" stroke-linejoin="round" stroke-width="8">
      </polyline>
     </svg>
    </div>
    <h2 class="text-2xl font-bold text-gray-800 mt-6">
     Pesanan Diterima!
    </h2>
    <p class="text-gray-600 mt-2">
     Pesanan kamu sudah kami terima, <strong>terima kasih telah melakukan pembayaran!</strong>
    </p>
   </div>
  </div>
  <!-- Custom Alert Modal Structure -->
  <div class="custom-alert-overlay hidden" id="custom-alert-modal">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm text-center p-8">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Pemberitahuan</h3>
        <p class="text-gray-600 mb-6" id="custom-alert-message"></p>
        <button class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700" id="close-alert-btn">OK</button>
    </div>
  </div>
  <script>
   document.addEventListener("DOMContentLoaded", () => {
    // Firebase Configuration Keys
    const firebaseConfig = {
      apiKey: "AIzaSyCCRGTeq4NN25eV31HuzeGqU8s3dhXIv5w",
      authDomain: "nyoba-doang-fd3e9.firebaseapp.com",
      projectId: "nyoba-doang-fd3e9",
      storageBucket: "nyoba-doang-fd3e9.firebasestorage.app",
      messagingSenderId: "825164926042",
      appId: "1:825164926042:web:5b9b7ef8fc04a2acebdc63",
      measurementId: "G-MFMLDSBK26"
    };

    // Cloudinary Configuration Keys (REPLACE WITH YOUR OWN KEYS!)
    // Anda perlu membuat akun Cloudinary GRATIS dan mendapatkan ini.
    // Upload Preset harus diatur sebagai "Unsigned" di dashboard Cloudinary Anda.
    // Untuk menyembunyikan Cloudinary, atur ke string kosong.
    const CLOUDINARY_CLOUD_NAME = ''; // Contoh: 'my-shop-cloud'
    const CLOUDINARY_UPLOAD_PRESET = ''; // Contoh: 'unsigned_uploads'


    // Initialize Firebase using global namespace (only Firestore is relevant)
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();


    const allProducts = [
      {
        id: 1,
        name: "Jas laboratorium",
        price: 140000, // Original price
        strikethroughPrice: 160000, // New strikethrough price
        description: "Jas Laboratorium berkualitas tinggi, dengan berbasis bahan american drill yang ketika dipakai akan terasa nyaman dan tidak panas. Wajib bagi setiap mahasiswa Metalurgi pada saat praktikum. Dilengkapi dengan bordir nama pada sisi kanan dan logo IMMt pada sisi kiri dada.",
        image: "assets/jaslab-1.jpg",
        hasSizes: true,
        sizes: ["S", "M", "L", "XL", "XXL", "3XL", "4XL", "5XL"], // Added more sizes
        detailImages: [
          "assets/jaslab-1.jpg",
          "assets/jaslab-2.jpg",
          "assets/size-chart-a.jpg",
        ],
        inBundle: true,
      },
      {
        id: 2,
        name: "Workshirt Kerja Praktik",
        price: 160000, // Original price
        strikethroughPrice: 175000, // New strikethrough price
        description: "Workshirt nyaman dan stylish untuk kegiatan kerja praktik Anda. Bahan kuat dan tahan lama yang siap dipakai kerja praktik anda.",
        image: "assets/workshirt-kp-1.jpg",
        hasSizes: true,
        sizes: ["S", "M", "L", "XL", "XXL", "3XL", "4XL"],
        detailImages: [
          "assets/workshirt-kp-1.jpg",
          "assets/workshirt-kp-2.jpg",
          "assets/size-chart-b.jpg",
        ],
        inBundle: false, // Not in SIMAK bundle
      },
      {
        id: 3,
        name: "Workshirt Metalurgi",
        price: 179000,
        description: "Tunjukkan kebanggaan Anda sebagai mahasiswa metalurgi dengan workshirt eksklusif ini.",
        image: "assets/workshirt-metal-1.jpg",
        hasSizes: true,
        sizes: ["S", "M", "L", "XL", "XXL", "3XL", "4XL", "5XL"],
        detailImages: [
          "assets/workshirt-metal-1.jpg",
          "assets/workshirt-metal-2.jpg",
          "assets/size-chart-c.jpg",
        ],
        inBundle: false, // Not in SIMAK bundle
      },
      {
        id: 4,
        name: "Sticker (3pcs)",
        price: 15000,
        description: "Paket 3 stiker unik dengan desain IMMt. Cocok untuk laptop, buku, atau dimanapun.",
        image: "assets/sticker-pack-1.jpg",
        hasSizes: false,
        detailImages: [
          "assets/sticker-pack-1.jpg",
          "assets/sticker-pack-2.jpg",
        ],
        inBundle: true, // In SIMAK bundle
      },
      {
        id: 5,
        name: "Sticker mobil",
        price: 15000,
        description: "Stiker khusus untuk mobil Anda, tunjukkan identitas bahwa anda adalah bagian dari Teknik Metalurgi!",
        image: "assets/sticker-mobil-1.jpg",
        hasSizes: false,
        hasOptions: true, // New property for options
        options: ["Stiker Fakultas Teknik", "Stiker Metalurgi"], // New options for sticker mobil
        detailImages: [
          "assets/sticker-mobil-1.jpg",
          "assets/sticker-mobil-2.jpg",
        ],
        inBundle: false, // Not in SIMAK bundle
      },
      {
        id: 6,
        name: "Keychain IMMt",
        price: 15000,
        description: "Gantungan kunci eksklusif IMMt, tersedia dalam dua desain unik. Pilih favorit Anda!",
        image: "assets/keychain-immt-1.jpg",
        hasSizes: false,
        hasOptions: true, // New property for options
        options: ["Keychain Kain Bordir", "Keychain Akrilik"], // New options
        detailImages: [
          "assets/keychain-immt-1.jpg",
          "assets/keychain-immt-2.jpg",
        ],
        inBundle: false, // Not in SIMAK bundle
      },
      {
        id: 7,
        name: "Keychain Makara FTUI",
        price: 15000,
        description: "Gantungan kunci Makara UI, simbol kebanggaan kami sebagai anak Teknik!",
        image: "assets/keychain-makara-1.jpg",
        hasSizes: false,
        detailImages: [
          "assets/keychain-makara-1.jpg",
          "assets/keychain-makara-2.jpg",
        ],
        inBundle: false, // Not in SIMAK bundle
      },
      {
        id: 8,
        name: "Paket Alat Gamtek",
        price: 250000,
        description: "Paket lengkap alat gambar teknik untuk menunjang kebutuhan perkuliahan Anda ketika menghadapi mata kuliah gambar teknik!<br>Paket Gamtek Berisikan :<br>1. Tabung Gamtek 64 CM<br>2. Penggaris<br>3. Penggaris MOR<br>4. Penghapus<br>5. Mal Huruf 3 & 6 mm<br>6. Mal lingkaran<br>7. Pensil Mekanik 0.5 & 0.7<br> 8. Isi Pensil 0.5 & 0.7<br> 9. Jangka<br>10. Buku Gambar A3<br> 11. Buku MM Block",
        image: "assets/gamtek-1.jpg",
        hasSizes: false,
        detailImages: [
          "assets/gamtek-1.jpg",
          "assets/gamtek-2.jpg",
          "assets/gamtek-3.jpg",
          "assets/gamtek-4.jpg",
          "assets/gamtek-5.jpg",
          "assets/gamtek-6.jpg",
          "assets/gamtek-7.jpg",
          "assets/gamtek-8.jpg",
          "assets/gamtek-9.jpg",
          "assets/gamtek-10.jpg",
          "assets/gamtek-11.jpg",
          "assets/gamtek-12.jpg",
        ],
        inBundle: false, // Not in SIMAK bundle
      },
      { // New Product: Topi
        id: 9,
        name: "Topi Metalurgi",
        price: 35000, // Updated price
        description: "Topi stylish dengan design yang sangat menarik, cocok untuk kegiatan sehari-hari menerjang panas dan hujan.",
        image: "assets/topi-immt-1.jpg",
        hasSizes: false,
        detailImages: [
          "assets/topi-immt-1.jpg",
          "assets/topi-immt-2.jpg",
        ],
        inBundle: true, // In SIMAK bundle
      },
      // Definisi Bundle Baru
      {
        id: 'simak-bundle', // ID unik untuk bundle ini
        name: 'SIMAK EDITION!! Bundle',
        image: 'assets/promo-simak-1.jpg', // Gambar utama untuk bundle
        description: 'Dapatkan Jaslab, Sticker (3pcs), dan Topi Metalurgi dengan harga spesial! Pilihan terbaik untuk persiapan SIMAK!',
        isBundle: true,
        bundleDiscount: 15000, // Diskon spesifik untuk bundle ini
        bundleItems: [ // Daftar item yang termasuk dalam bundle
            { productId: 1, quantity: 1, requiresSize: true, sizeProperty: 'jaslabSize' }, // Jaslab (ID 1) memerlukan ukuran
            { productId: 4, quantity: 1 }, // Sticker (3pcs) (ID 4)
            { productId: 9, quantity: 1 }  // Topi Metalurgi (ID 9)
        ],
        promoImages: [ // Gambar-gambar yang akan ditampilkan di halaman detail bundle
            "assets/jaslab-1.jpg",
            "assets/size-chart-a.jpg",
            "assets/sticker-pack-1.jpg",
            "assets/topi-immt-1.jpg",
        ]
      },
      // Tambahkan bundle lain di sini jika ada:
      /*
      {
        id: 'bundle-wisuda',
        name: 'Paket Wisuda Lengkap',
        image: 'assets/bundle-wisuda.jpg',
        description: 'Persiapan wisuda lebih mudah dengan paket lengkap ini!',
        isBundle: true,
        bundleDiscount: 20000,
        bundleItems: [
            { productId: 2, quantity: 1, requiresSize: true, sizeProperty: 'workshirtKpSize' }, // Contoh: Workshirt KP
            { productId: 7, quantity: 1 }, // Contoh: Keychain Makara FTUI
            // ... item lain
        ],
        promoImages: [
            "assets/workshirt-kp-1.jpg",
            "assets/keychain-makara-1.jpg",
        ]
      }
      */
    ];

    // MODIFIED: Untuk menampilkan semua produk di bagian "Koleksi Produk Pilihan Kami"
    const products = allProducts.filter(p => !p.isBundle); // Hanya tampilkan produk individual di grid utama

    let cart = [];
    let filteredProducts = [...products]; // Untuk menyimpan produk setelah filter pencarian

    const dom = {
      productsGrid: document.getElementById("products-grid"),
      cartModal: document.getElementById("cart-modal"),
      successModal: document.getElementById("success-modal"),
      productOverviewModal: document.getElementById("product-overview-modal"),
      closeProductOverviewModalBtn: document.getElementById("close-product-overview-modal"),
      openCartBtn: document.getElementById("open-cart-btn"),
      checkoutBtn: document.getElementById("checkout-btn"),
      cartItemsContainer: document.getElementById("cart-items"),
      cartTotalEl: document.getElementById("cart-total"),
      cartCountBadge: document.getElementById("cart-count-badge"),
      closeModalBtns: document.querySelectorAll(".close-modal-btn"),

      // Elements for main promo cards (now generic redirect)
      promoSimakCard: document.getElementById("promo-simak-card"), // For overview
      mainPromoCardSimak: document.getElementById("main-promo-card"), // For main promo section

      continueShoppingBtn: document.getElementById("continue-shopping-btn"), // New button for continue shopping

      // Custom Alert Modal
      customAlertModal: document.getElementById("custom-alert-modal"),
      customAlertMessage: document.getElementById("custom-alert-message"),
      closeAlertBtn: document.getElementById("close-alert-btn"),

      searchInput: document.getElementById("search-input"),
    };

    // Helper function to format currency
    const formatCurrency = (n) =>
      new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0,
      }).format(n);
    
    // Function to calculate price based on product and size, with size increments
    const calculatePrice = (basePrice, size, productId = null) => {
        let price = basePrice;
        const sizeIncrements = {
            "S": 0, "M": 0, "L": 0,
            "XL": 1, "XXL": 2, "3XL": 3, "4XL": 4, "5XL": 5
        };
        
        let incrementAmount = 0;

        // Apply specific increment amounts based on productId
        if (productId === 1) { // Jas laboratorium
            incrementAmount = 10000;
        } else if (productId === 2) { // Workshirt Kerja Praktik
            incrementAmount = 5000;
        }
        // Add more product-specific increment amounts here if needed

        const sizeIndex = sizeIncrements[size];

        if (sizeIndex > 0) { // Only apply if size is XL or larger
            price = basePrice + (sizeIndex * incrementAmount);
        }
        return price;
    };

    // Function to toggle modal visibility and manage body scroll
    const toggleModal = (modal, show) => {
      modal.classList.toggle("visible", show);
      if (show) {
          document.body.style.overflow = 'hidden'; // Disable body scroll
          lucide.createIcons(); // Recreate icons when modal is visible
      } else {
          // Only re-enable scroll if no other modal is visible
          const anyOtherModalVisible = Array.from(document.querySelectorAll('.modal-overlay')).some(m => m.classList.contains('visible'));
          if (!anyOtherModalVisible) {
              document.body.style.overflow = ''; // Enable body scroll
          }
      }
    };


    // Function Definitions (moved to top for scope visibility)
    const renderProducts = (productsToRender) => {
      dom.productsGrid.innerHTML = "";
      if (productsToRender.length === 0) {
          dom.productsGrid.innerHTML = `<p class="text-center text-gray-500 text-lg col-span-full">Tidak ada produk yang ditemukan.</p>`;
          return;
      }
      productsToRender.forEach((product) => {
        // Determine price to display on product card (original price)
        const displayPrice = product.price;
        // Determine strikethrough price if available
        const displayStrikethroughPrice = product.strikethroughPrice;

        const productCard = `
                    <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden flex flex-col transform hover:-translate-y-1 transition-transform duration-300" data-product-id="${
                          product.id
                        }">
                            <img src="${product.image}" alt="${
              product.name
            }" class="w-full h-full object-cover pointer-events-none" onerror="this.onerror=null; this.src='assets/placeholder.png';">
                            <div class="p-6 flex-grow flex flex-col pointer-events-none">
                                <div class="flex-grow">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">${
                                      product.name
                                    }</h3>
                                    <div class="flex items-baseline mb-4">
                                    ${displayStrikethroughPrice ? `<p class="text-lg font-semibold text-gray-500 strikethrough-price">${formatCurrency(displayStrikethroughPrice)}</p>` : ''}
                                    <p class="text-lg font-semibold text-indigo-600">${formatCurrency(
                                  displayPrice
                                )}${product.hasSizes ? " (mulai)" : ""}</p>
                                </div>
                            </div>
                            <div class="mt-auto">
                                <button class="w-full bg-gray-800 text-white font-semibold py-2 px-4 rounded-lg">Lihat Detail</button>
                            </div>
                        </div>
                    </div>`;
        dom.productsGrid.innerHTML += productCard;
      });
    };

    // Function to load cart from localStorage
    const loadCart = () => {
        const storedCart = localStorage.getItem('immtShopCart');
        cart = storedCart ? JSON.parse(storedCart) : [];
    };

    // Function to save cart to localStorage
    const saveCart = () => {
        localStorage.setItem('immtShopCart', JSON.stringify(cart));
    };

    const renderCart = () => {
      dom.cartItemsContainer.innerHTML = "";
      let total = 0,
        itemCount = 0;
      if (cart.length === 0) {
        dom.cartItemsContainer.innerHTML = `<p class="text-gray-500 text-center py-8">Keranjang belanja Anda kosong.</p>`;
        dom.checkoutBtn.disabled = true;
      } else {
        cart.forEach((item) => {
          const itemTotal = item.finalPrice * item.quantity;
          total += itemTotal;
          itemCount += item.quantity;

          // If it's a bundle, display only the bundle name and its total price
          if (item.isBundle) {
              dom.cartItemsContainer.innerHTML += `
                    <div class="flex items-center justify-between py-4 border-b last:border-b-0">
                        <div class="flex items-center gap-4">
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 rounded-lg object-cover">
                            <div>
                                <h4 class="font-semibold">${item.name}</h4>
                                <p class="text-sm text-gray-500">${formatCurrency(item.finalPrice)}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="px-3 text-center">${item.quantity}</span>
                            <button class="remove-from-cart-btn text-red-500 hover:text-red-700 p-1" data-cart-item-id="${item.cartItemId}">
                                <i data-lucide="trash-2" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>`;
          } else {
              // Determine image path based on product ID and selected option for regular items
              let itemImage = item.image; // Default to product's main image
              if (item.id === 6) { // Keychain IMMt
                  if (item.option === "Keychain Kain Bordir") {
                      itemImage = "assets/keychain-immt-1.jpg";
                  } else if (item.option === "Keychain Akrilik") {
                      itemImage = "assets/keychain-immt-2.jpg";
                  }
              } else if (item.id === 5) { // Sticker mobil
                  if (item.option === "Stiker Fakultas Teknik") {
                      itemImage = "assets/sticker-mobil-1.jpg";
                  } else if (item.option === "Stiker Metalurgi") {
                      itemImage = "assets/sticker-mobil-2.jpg";
                  }
              }

              dom.cartItemsContainer.innerHTML += `<div class="flex items-center justify-between py-4 border-b last:border-b-0"><div class="flex items-center gap-4"><img src="${
                    itemImage
                  }" alt="${
                    item.name
                  }" class="w-16 h-16 rounded-lg object-cover"><div><h4 class="font-semibold">${
                    item.name
                  } ${
                    item.size ? `(${item.size})` : ""
                  }${item.option ? ` - ${item.option}` : ""}</h4><p class="text-sm text-gray-500">${formatCurrency(
                    item.finalPrice
                  )}</p></div></div><div class="flex items-center gap-3"><div class="flex items-center border rounded-md"><button class="update-cart-quantity-btn p-2" data-cart-item-id="${
                    item.cartItemId
                  }" data-change="-1" ${item.quantity === 1 ? 'disabled' : ''}>-</button><span class="px-3 text-center">${
                    item.quantity
                  }</span><button class="update-cart-quantity-btn p-2" data-cart-item-id="${
                    item.cartItemId
                  }" data-change="1">+</button></div><button class="remove-from-cart-btn text-red-500 hover:text-red-700 p-1" data-cart-item-id="${
                    item.cartItemId
                  }"><i data-lucide="trash-2" class="w-6 h-6"></i></button></div></div>`;
          }
        });
        dom.checkoutBtn.disabled = false;
      }
      dom.cartTotalEl.textContent = formatCurrency(total);
      dom.cartCountBadge.textContent = itemCount;
      lucide.createIcons();
    };

    const updateCartQuantity = (cartItemId, change) => {
      let cartItem = cart.find((item) => item.cartItemId === cartItemId);
      if (!cartItem || cartItem.isBundle) { // Prevent quantity change for bundles in cart
          return;
      }
      cartItem.quantity += change;
      if (cartItem.quantity <= 0) {
        cart = cart.filter((item) => item.cartItemId !== cartItemId);
      }
      saveCart(); // Save cart after updating quantity
      updateUI();
    };

    const updateUI = () => {
      renderProducts(filteredProducts); // Render filtered products
      renderCart();
    };

    // Custom alert modal implementation
    const showCustomAlert = (message) => {
        dom.customAlertMessage.textContent = message;
        dom.customAlertModal.classList.remove('hidden');
    };

    dom.closeAlertBtn.addEventListener('click', () => {
        dom.customAlertModal.classList.add('hidden');
    });

    // Event Listeners

    // Click listener for product grid (opens product detail)
    dom.productsGrid.addEventListener("click", (e) => {
        const productCard = e.target.closest(".product-card");
        if (productCard) {
            const productId = parseInt(productCard.dataset.productId);
            // Redirect to product_detail.html with product ID
            window.location.href = `product_detail.html?id=${productId}`;
        }
    });

    // Main Event Listener using event delegation on document.body
    document.body.addEventListener("click", (e) => {
        const removeCartBtn = e.target.closest(".remove-from-cart-btn");
        if (removeCartBtn) {
            cart = cart.filter(
                (item) => item.cartItemId !== removeCartBtn.dataset.cartItemId
            );
            saveCart(); // Save cart after removing item
            updateUI();
            return; // Important: stop execution after handling event
        }

        const updateQuantityBtn = e.target.closest(".update-cart-quantity-btn");
        if (updateQuantityBtn) {
            const cartItemId = updateQuantityBtn.dataset.cartItemId;
            const change = parseInt(updateQuantityBtn.dataset.change);
            updateCartQuantity(cartItemId, change);
            return;
        }

        // --- Handling General Close Modal Button ---
        const closeModalBtn = e.target.closest(".close-modal-btn");
        if (closeModalBtn) {
            toggleModal(document.getElementById(closeModalBtn.dataset.modalId), false);
            return;
        }
    });

    dom.openCartBtn.addEventListener("click", () =>
      toggleModal(dom.cartModal, true)
    );

    // Add event listener for "Continue Shopping" button
    dom.continueShoppingBtn.addEventListener("click", () => {
        toggleModal(dom.cartModal, false); // Close the cart modal
    });

    dom.checkoutBtn.addEventListener("click", () => {
      if (cart.length > 0) {
        toggleModal(dom.cartModal, false);
        window.location.href = 'customer_data.html'; // Redirect to customer data page
      } else {
          showCustomAlert("Keranjang belanja Anda kosong. Silakan tambahkan produk terlebih dahulu.");
      }
    });

    // Product Overview Modal Event Listener
    dom.closeProductOverviewModalBtn.addEventListener("click", () => {
        toggleModal(dom.productOverviewModal, false);
    });

    // Handle clicks on promo items in overview modal and main promo section
    const handlePromoClick = (e) => {
        const promoItem = e.target.closest(".product-overview-item, #main-promo-card");
        if (promoItem) {
            const promoId = promoItem.dataset.promoId;
            toggleModal(dom.productOverviewModal, false); // Close overview modal

            // Redirect to the generic bundle detail page with the bundle ID
            window.location.href = `bundle_detail.html?id=${promoId}`;
        }
    };

    dom.productOverviewModal.addEventListener("click", handlePromoClick);
    dom.mainPromoCardSimak.addEventListener("click", handlePromoClick); // Add listener to main SIMAK promo card


    // Search functionality
    dom.searchInput.addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        // Filter only products (exclude bundles from main product grid search)
        filteredProducts = allProducts.filter(product =>
            !product.isBundle && product.name.toLowerCase().includes(searchTerm)
        );
        renderProducts(filteredProducts);
    });

    // Initial setup when page loads
    loadCart(); // Load cart from localStorage
    updateUI();
    // If Cloudinary is disabled, ensure the finish payment button is always active (this is now irrelevant for index.html)
    // toggleModal(dom.productOverviewModal, true); // Show product overview modal on load

    // Check for hash in URL to open cart modal on page load
    if (window.location.hash === '#cart') {
        toggleModal(dom.cartModal, true);
        // Clear the hash to prevent it from reopening on refresh
        history.replaceState(null, null, ' ');
    }

    // New: Handle browser back/forward cache to ensure cart is always up-to-date
    window.addEventListener('pageshow', (event) => {
        if (event.persisted) {
            // Page was restored from BFCache, reload cart and update UI
            loadCart();
            updateUI();
            // Ensure product overview modal is closed if it was open due to BFCache
            toggleModal(dom.productOverviewModal, false);
        }
    });
   });
  </script>
 </body>
</html>
